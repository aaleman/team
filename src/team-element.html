<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer-fontawesome/polymer-fontawesome.html">
<link rel="import" href="../bower_components/sortable-table/sortable-table.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">


<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-header.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-footer.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-project-browser.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-bioformat.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-job-no-ready.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/variant/jso-variant-component.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/jso-sortable-table-ajax.html">

<!-- Genome --viewer-->
<script src="../lib/jsorolla/src/lib/svg.js"></script>
<script src="../lib/jsorolla/src/lib/utils.js"></script>

<script src="../lib/jsorolla/src/genome-viewer/gv-config.js"></script>

<script src="../lib/jsorolla/src/lib/widgets/ux-window.js"></script>

<script src="../lib/jsorolla/src/lib/widgets/feature/info/info-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/info/gene-info-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/info/protein-info-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/info/snp-info-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/info/transcript-info-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/info/vcf-variant-info-widget.js"></script>

<script src="../lib/jsorolla/src/lib/cellbase-manager.js"></script>

<script src="../lib/jsorolla/src/lib/data-adapter/feature/cellbase-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/sequence-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/opencga-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/bam-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/feature-data-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/vcf-data-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/gff2-data-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/gff3-data-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/bed-data-adapter.js"></script>
<script src="../lib/jsorolla/src/lib/data-adapter/feature/das-adapter.js"></script>

<script src="../lib/jsorolla/src/lib/data-source/data-source.js"></script>
<script src="../lib/jsorolla/src/lib/data-source/string-data-source.js"></script>
<script src="../lib/jsorolla/src/lib/data-source/file-data-source.js"></script>

<script src="../lib/jsorolla/src/lib/region.js"></script>
<script src="../lib/jsorolla/src/lib/feature-binary-search-tree.js"></script>
<script src="../lib/jsorolla/src/lib/cache/file-feature-cache.js"></script>
<script src="../lib/jsorolla/src/lib/cache/bam-cache.js"></script>

<script src="../lib/jsorolla/src/lib/cache/memory-store.js"></script>
<script src="../lib/jsorolla/src/lib/cache/indexedDB-store.js"></script>
<script src="../lib/jsorolla/src/lib/cache/feature-chunk-cache.js"></script>

<script src="../lib/jsorolla/src/lib/widgets/feature/file/url-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/file/file-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/file/vcf-file-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/file/gff-file-widget.js"></script>
<script src="../lib/jsorolla/src/lib/widgets/feature/file/bed-file-widget.js"></script>


<script src="../lib/jsorolla/src/genome-viewer/navigation-bar.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/chromosome-panel.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/karyotype-panel.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/tracks/tracklist-panel.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/status-bar.js"></script>


<script src="../lib/jsorolla/src/genome-viewer/tracks/track.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/tracks/feature-track.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/tracks/sequence-track.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/tracks/gene-track.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/tracks/bam-track.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/tracks/alignment-track.js"></script>


<script src="../lib/jsorolla/src/genome-viewer/renderers/renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/feature-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/sequence-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/feature-cluster-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/histogram-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/gene-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/bam-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/vcf-multisample-renderer.js"></script>
<script src="../lib/jsorolla/src/genome-viewer/renderers/alignment-renderer.js"></script>


<script src="../lib/jsorolla/src/genome-viewer/genome-viewer.js"></script>

<script src="panel.js"></script>


<link rel="import" href="team-home.html">
<link rel="import" href="team-bar.html">
<link rel="import" href="team-show-panel.html">
<link rel="import" href="team-search-element.html">

<polymer-element name="team-element">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                cursor: default;
                font-size: 13px;
                height: 100%;
            }

            .content {
                background-color: #435f7a;
                position: relative;
                min-height: calc(100vh - 160px);
            }

            .link > a {
                color: #CCCCCC;
                text-decoration: none;
            }

            .link > a:visited {
                color: #CCCCCC;
            }

            .link:hover, .link > a:hover {
                color: #FFFFFF;
            }

            jso-project-browser {
                height: calc(100vh - 160px);
            }

            /*Right Side*/
            .right-side {
                top: 94px;
                right: 0px;
                position: absolute;

            }

        </style>
        <jso-header id="jsoHeader"
                    on-logout="{{handleLogout}}"
                    selectedOption="{{selectedOption}}"
                    userData="{{userData}}"
                    showJobs="false"
                    options="{{options}}"
                    allowLogin="false"
                    jobItem="{{jobItem}}"
                >
            <span class="title">TEAM</span>
            <span class="description">1.1.0</span>

            <jso-help-menu class="helpmenu" selectedOption="{{selectedOption}}">
                <div class="link">
                    <a href="https://github.com/babelomics/team/wiki" target="_blank">
                        <font-awesome icon="book"></font-awesome>
                        &nbsp; Documentation
                    </a>
                </div>
                <div class="link">
                    <a href="https://github.com/babelomics/team/wiki/tutorial" target="_blank">
                        <font-awesome icon="list-alt"></font-awesome>
                        &nbsp; Tutorial
                    </a>
                </div>
                <div class="link">
                    <a href="https://github.com/babelomics/team" target="_blank">
                        <font-awesome icon="github"></font-awesome>
                        &nbsp; Source Code
                    </a>
                </div>
            </jso-help-menu>
        </jso-header>

        <div class="content">
            <team-bar
                    on-panel-show="{{handlePanelShow}}"
                    on-panel-export="{{handlePanelExport}}"
                    on-panel-import="{{handlePanelImport}}"
                    on-panel-clear="{{handlePanelClear}}"
                    on-example-show="{{handleExamplePanelShow}}"
                    ></team-bar>

            <team-search-element></team-search-element>
            <div class="right-side">
                <team-show-panel
                        id="teamShowPanel"
                        hidden?="{{hideUserPanel}}"
                        hideFlag="{{hideUserPanel}}"
                        userSettings="{{userSettings}}">
                </team-show-panel>

                <team-show-panel
                        id="teamShowExamplePanel"
                        hidden?="{{hideExamplePanel}}"
                        hideFlag="{{hideExamplePanel}}"
                        userSettings="{{userSettings}}"
                        example="true">
                </team-show-panel>

            </div>
        </div>
        <jso-footer>
            BierApp: created by Computational Genomics Department
            <br>
            Principe Felipe Research Center
            <br>
            2015
        </jso-footer>
    </template>
    <script>
        Polymer({
            hideUserPanel: false,
            hideExamplePanel: false,
            allowedTools: null,
            userSettings: null,
            created: function () {
                this.selectedOption = 'home';
                this.showJobs = false;
                this.userData = {};

            },
            ready: function () {
                this.userSettings = new UserSettings();
                console.log(this.userSettings);
            },
            handlePanelShow: function (e) {
                console.log("Panel Show");
                this.hideUserPanel = false;
            },
            handleExamplePanelShow: function (e) {
                console.log("Panel Show");
                this.hideExamplePanel = false;
            },
            userSettingsChanged: function (oldValue, newValue) {
                console.log("cambia user Settings");
            },
            observe: {
                'userSettings.userDefined': 'userSettingsChanged'
            },
            handlePanelExport: function (e) {
                var content = this.userSettings.toJson();

                var blob = new Blob([content], {type: "application/json"});
                var url = URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = "panels.json";
                var fileName = window.prompt("Please enter file name", "panels.json")
                if (fileName != null && fileName != "") {
                    link.download = fileName;
                }
                var event = new MouseEvent('click', {
                    'view': window,
                    'bubbles': true,
                    'cancelable': true
                });
                link.dispatchEvent(event);
            },
            handlePanelImport: function (e) {
                var me = this;
                var input = document.createElement('input');
                input.setAttribute("type", "file");
                input.addEventListener("change", function (e) {
                    var file = e.currentTarget.files[0];
                    if (file) {
                        var reader = new FileReader();
                        reader.onload = function (evt) {
                            me.userSettings.importData(evt.target.result);
                        };
                        reader.readAsText(file);
                        e.currentTarget.value = null;
                    }
                });
                var event = new MouseEvent('click', {
                    'view': window,
                    'bubbles': true,
                    'cancelable': true
                });
                input.dispatchEvent(event);
            },
            handlePanelClear: function (e) {
                if (confirm('All changes will be lost. Are you sure?')) {
                    this.userSettings.clear();
                }
            },
        });
    </script>
</polymer-element>
