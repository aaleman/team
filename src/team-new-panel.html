<link rel="import" href="../bower_components/core-list/core-list.html">
<polymer-element name="team-new-panel" attributes="selectedOption">
    <template>
        <link rel="stylesheet" href="../lib/jsorolla/src/lib/components/jso-style.css">
        <style>
            :host {
                display: block;
                position: relative;
                box-sizing: border-box;
                padding: 15px 40px;

                z-index: 50000;
                margin: 0px auto 0px auto;

                width: 80%;
                min-width: 800px;
                border: 1px solid #c6d0da;
                transition: all 0.2s;
                box-shadow: 2px 6px 15px 8px rgba(0, 0, 0, 0.30);
                background-color: #FFFFFF;

            }

            .title {
                text-align: center;
                font-size: 25px;
                color: #445D76;
                margin-bottom: 10px;
            }

            .close {
                color: #aaa;
            }

            .close:hover {
                color: #ffad76;
            }

            .message {
                margin-top: 20px;
            }

            .botbar {
                margin-top: 10px;
            }

            label {
                display: block;
            }

            core-list {
                border: solid 1px black;
                width: 300px;
            }

            .selected {
                background: silver;
            }
        </style>
        <div class="title" horizontal layout>
            <div flex>
                New Panel
            </div>
            <div class="close" on-click="{{handleCancel}}">
                <font-awesome icon="times"></font-awesome>
            </div>
        </div>
        <div id="content">
            <div horizontal layout
                    >
                <core-drag-drop></core-drag-drop>
                <core-list id="phenotypeList" data="{{phenotypes}}"
                           height="30"
                           selectionEnabled="true"
                           multi="true"
                           selection="{{selection}}"
                           style="height: 200px; margin-right: 100px;"
                        >
                    <template>
                        <div class="item {{ {selected: selected} | tokenList }}" style="height: 30px;"
                             draggable="true"
                             on-dragstart="{{handleDragStart}}"
                             phenotypeValue="{{model.value}}"
                             phenotypeName="{{model.name}}"
                                >
                            <span class="from">{{model.name}}</span>
                        </div>
                    </template>
                </core-list>

                <core-list id="selectedPhenotypes"
                           data="{{selectedPhenotypes}}"
                           height="30"
                           selectionEnabled="true"
                           multi="true"
                           selection="{{selectionSelectedPhenotype}}"
                           style="height: 200px;"
                           on-dragover="{{handleDragOver}}"
                           on-drop="{{handleDrop}}"
                        >
                    <template>
                        <div class="item" style="height: 30px;">
                            <span class="from">{{model.name}}</span>
                        </div>
                    </template>
                </core-list>
            </div>
        </div>

        <div class="message">{{message}}</div>
    </template>
    <script>
        Polymer({
            phenotypes: null,
            selectedPhenotypes: null,
            selection: 'sel',
            created: function () {
                var me = this;
                this.phenotypes = this._getDiseases();
                this.selectedPhenotypes = [];

            },
            ready: function () {
            },
            handleDrop: function (event) {
                event.preventDefault();

                console.log("drop");
                var phenoval = event.dataTransfer.getData("phenoval");
                var phenoname = event.dataTransfer.getData("phenoname");


                this.phenotypes = this.phenotypes.filter(function (element) {
                    return element.value != phenoval;
                });

                this.selectedPhenotypes.push({
                    name: phenoname,
                    value: phenoval
                });


            },
            handleDragOver: function (event) {
                event.preventDefault();
                console.log("over")
            },
            handleDragEnd: function (event) {
                console.log("end");
            },
            handleDragStart: function (event) {
                event.dataTransfer.setData("phenoval", event.target.getAttribute("phenotypevalue"));
                event.dataTransfer.setData("phenoname", event.target.getAttribute("phenotypename"));
            },
            _getDiseases: function () {

                var data = [];
                $.ajax({
                    url: CELLBASE_HOST + "/v3/hsapiens/feature/snp/phenotypes?exclude=associatedGenes",
                    dataType: 'json',
//                    async: false,
                    success: function (response, textStatus, jqXHR) {
                        for (var i = 0; i < response.response.result.length; i++) {
                            var disease = response.response.result[i].phenotype;
                            data.push(
                                    {
                                        value: disease,
                                        name: disease
                                    });
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log('Error downloading Diseases');
                    }
                });
                console.log(data);
                return data;
            }
            ,
            handleCancel: function () {
                this.selectedOption = '';
            }
            ,

            handlePhenotypeFilter: function (val) {

                debugger
                var pheno = "retinitis";

                return val.match(/retinitis/i);

            }

        })
        ;
    </script>
</polymer-element>
